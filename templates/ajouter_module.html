<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nouveau Module</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container mt-4">
        <div class="row justify-content-center">
            <div class="col-md-10">
                <div class="card">
                    <div class="card-header">
                        <h4 style="color: white;">‚ûï Nouveau Module d'Enseignement</h4>
                    </div>
                    <div class="card-body">
                        <form method="POST">
                            <!-- Informations g√©n√©rales du module -->
                            <div class="row mb-4">
                                <div class="col-12">
                                    <h5 class="text-primary mb-3">üìö Informations du Module</h5>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">Nom du Module *</label>
                                        <input type="text" class="form-control" name="nom_module" required placeholder="Ex: Algorithmes et Structures de Donn√©es">
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">Niveau *</label>
                                        <select class="form-select" name="niveau" required>
                                            <option value="">Choisir...</option>
                                            <option value="Licence 1">Licence 1</option>
                                            <option value="Licence 2">Licence 2</option>
                                            <option value="Licence 3">Licence 3</option>
                                            <option value="Master 1">Master 1</option>
                                            <option value="Master 2">Master 2</option>
                                            <option value="Doctorat">Doctorat</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">Ann√©e Universitaire *</label>
                                        <select class="form-select" name="annee_universitaire" required>
                                            <option value="2023-2024">2023-2024</option>
                                            <option value="2024-2025" selected>2024-2025</option>
                                            <option value="2025-2026">2025-2026</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- Informations de l'√©tablissement -->
                            <div class="row mb-4">
                                <div class="col-12">
                                    <h5 class="text-primary mb-3">üè´ √âtablissement</h5>
                                </div>
                                <div class="col-md-12">
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">√âtablissement *</label>
                                        <select class="form-select" name="ecole_id" id="ecoleSelect" required>
                                            <option value="">S√©lectionner un √©tablissement existant</option>
                                            {% for ecole in ecoles %}
                                            <option value="{{ ecole.id }}">{{ ecole.nom }} ({{ ecole.type_etablissement or 'N/A' }}, {{ ecole.ville or 'N/A' }})</option>
                                            {% endfor %}
                                            <option value="new">‚ûï Ajouter un nouvel √©tablissement</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- Nouveau √©tablissement (masqu√© par d√©faut) -->
                            <div class="row mb-4" id="newEcoleFields" style="display: none;">
                                <div class="col-12">
                                    <h6 class="text-primary mb-3">üìù D√©tails du Nouvel √âtablissement</h6>
                                </div>
                                <div class="col-md-3">
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">Nom de l'√©tablissement *</label>
                                        <input type="text" class="form-control" name="new_ecole_nom" placeholder="Universit√© de...">
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">Type d'√©tablissement *</label>
                                        <input type="text" class="form-control" name="new_ecole_type" placeholder="Universit√©, IUT, etc.">
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">Ville *</label>
                                        <input type="text" class="form-control" name="new_ecole_ville" placeholder="Ville">
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">Contact</label>
                                        <input type="text" class="form-control" name="new_ecole_contact" placeholder="Email ou t√©l√©phone">
                                    </div>
                                </div>
                            </div>

                            <!-- Volumes horaires -->
                            <div class="row mb-4">
                                <div class="col-12">
                                    <h5 class="text-primary mb-3">‚è∞ Volumes Horaires</h5>
                                </div>
                                <div class="col-md-4">
                                    <div class="card border-info">
                                        <div class="card-body text-center">
                                            <h6 class="card-title text-info">Cours Magistral (CM)</h6>
                                            <div class="mb-2">
                                                <label class="form-label small">Volume (heures)</label>
                                                <input type="number" class="form-control" name="volume_cm" step="0.5" min="0" value="0">
                                            </div>
                                            <div>
                                                <label class="form-label small">Tarif horaire (FCFA)</label>
                                                <input type="number" class="form-control" name="tarif_cm" min="0" step="100" value="0">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="card border-success">
                                        <div class="card-body text-center">
                                            <h6 class="card-title text-success">Travaux Dirig√©s (TD)</h6>
                                            <div class="mb-2">
                                                <label class="form-label small">Volume (heures)</label>
                                                <input type="number" class="form-control" name="volume_td" step="0.5" min="0" value="0">
                                            </div>
                                            <div>
                                                <label class="form-label small">Tarif horaire (FCFA)</label>
                                                <input type="number" class="form-control" name="tarif_td" min="0" step="100" value="0">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="card border-warning">
                                        <div class="card-body text-center">
                                            <h6 class="card-title text-warning">Travaux Pratiques (TP)</h6>
                                            <div class="mb-2">
                                                <label class="form-label small">Volume (heures)</label>
                                                <input type="number" class="form-control" name="volume_tp" step="0.5" min="0" value="0">
                                            </div>
                                            <div>
                                                <label class="form-label small">Tarif horaire (FCFA)</label>
                                                <input type="number" class="form-control" name="tarif_tp" min="0" step="100" value="0">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- R√©sum√© et calculs -->
                            <div class="row mb-4">
                                <div class="col-12">
                                    <h5 class="text-primary mb-3">üìä R√©sum√© Financier</h5>
                                </div>
                                <div class="col-md-4">
                                    <div class="card bg-light border-primary">
                                        <div class="card-body text-center">
                                            <h6 class="card-title text-primary">Volume Total</h6>
                                            <h4 class="text-primary" id="volume_total_display">0.0 h</h4>
                                            <small class="text-muted">heures</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="card bg-light border-success">
                                        <div class="card-body text-center">
                                            <h6 class="card-title text-success">Montant Total</h6>
                                            <h4 class="text-success" id="montant_total_display">0 FCFA</h4>
                                            <small class="text-muted">montant brut</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="card bg-light border-info">
                                        <div class="card-body text-center">
                                            <h6 class="card-title text-info">Tarif Horaire Total</h6>
                                            <h4 class="text-info" id="tarif_total_display">0 FCFA</h4>
                                            <small class="text-muted">somme des tarifs</small>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Actions -->
                            <div class="row">
                                <div class="col-12">
                                    <div class="d-flex gap-2 justify-content-center">
                                        <button type="submit" class="btn btn-success btn-lg">
                                            <i class="fas fa-save"></i> Enregistrer le Module
                                        </button>
                                        <a href="/" class="btn btn-outline-secondary btn-lg">
                                            <i class="fas fa-arrow-left"></i> Retour au Tableau de Bord
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function calculateTotals() {
            // Get values
            const volume_cm = parseFloat(document.querySelector('input[name="volume_cm"]').value) || 0;
            const volume_td = parseFloat(document.querySelector('input[name="volume_td"]').value) || 0;
            const volume_tp = parseFloat(document.querySelector('input[name="volume_tp"]').value) || 0;
            const tarif_cm = parseFloat(document.querySelector('input[name="tarif_cm"]').value) || 0;
            const tarif_td = parseFloat(document.querySelector('input[name="tarif_td"]').value) || 0;
            const tarif_tp = parseFloat(document.querySelector('input[name="tarif_tp"]').value) || 0;

            // Calculate totals
            const volume_total = volume_cm + volume_td + volume_tp;
            const montant_total = (volume_cm * tarif_cm) + (volume_td * tarif_td) + (volume_tp * tarif_tp);
            const tarif_total = tarif_cm + tarif_td + tarif_tp;

            // Update display
            document.getElementById('volume_total_display').textContent = volume_total.toFixed(1) + ' h';
            document.getElementById('montant_total_display').textContent = montant_total.toLocaleString('fr-FR') + ' FCFA';
            document.getElementById('tarif_total_display').textContent = tarif_total.toLocaleString('fr-FR') + ' FCFA';
        }

        // Add event listeners to all numeric inputs
        document.querySelectorAll('input[type="number"]').forEach(input => {
            input.addEventListener('input', calculateTotals);
        });

        // Toggle new school fields visibility
        document.getElementById('ecoleSelect').addEventListener('change', function() {
            const newEcoleFields = document.getElementById('newEcoleFields');
            if (this.value === 'new') {
                newEcoleFields.style.display = 'block';
            } else {
                newEcoleFields.style.display = 'none';
            }
        });

        // Initial calculation
        calculateTotals();
    </script>
</body>
</html>
