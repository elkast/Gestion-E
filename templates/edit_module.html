<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modifier Module</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container mt-4">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <h4>✏️ Modifier le Module d'Enseignement</h4>
                    </div>
                    <div class="card-body">
                        <form method="POST">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Nom du Module *</label>
                                        <input type="text" class="form-control" name="nom_module" value="{{ module.nom_module }}" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Établissement *</label>
                                        <select class="form-select" name="ecole_id" id="ecoleSelect" required>
                                            <option value="">Sélectionner un établissement</option>
                                            {% for ecole in ecoles %}
                                            <option value="{{ ecole.id }}" {% if ecole.id == module.ecole_id %}selected{% endif %}>{{ ecole.nom }}</option>
                                            {% endfor %}
                                            <option value="new">➕ Ajouter un nouvel établissement</option>
                                        </select>
                                        <div id="newEcoleFields" style="margin-top:10px;">
                                            <input type="text" class="form-control mb-2" name="new_ecole_nom" placeholder="Nom de l'établissement">
                                            <input type="text" class="form-control mb-2" name="new_ecole_type" placeholder="Type d'établissement">
                                            <input type="text" class="form-control mb-2" name="new_ecole_ville" placeholder="Ville">
                                            <input type="text" class="form-control mb-2" name="new_ecole_contact" placeholder="Contact">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Niveau *</label>
                                        <select class="form-select" name="niveau" required>
                                            <option value="Licence 1" {% if module.niveau == 'Licence 1' %}selected{% endif %}>Licence 1</option>
                                            <option value="Licence 2" {% if module.niveau == 'Licence 2' %}selected{% endif %}>Licence 2</option>
                                            <option value="Licence 3" {% if module.niveau == 'Licence 3' %}selected{% endif %}>Licence 3</option>
                                            <option value="Master 1" {% if module.niveau == 'Master 1' %}selected{% endif %}>Master 1</option>
                                            <option value="Master 2" {% if module.niveau == 'Master 2' %}selected{% endif %}>Master 2</option>
                                            <option value="Doctorat" {% if module.niveau == 'Doctorat' %}selected{% endif %}>Doctorat</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Année Universitaire *</label>
                                        <select class="form-select" name="annee_universitaire" required>
                                            <option value="2023-2024" {% if module.annee_universitaire == '2023-2024' %}selected{% endif %}>2023-2024</option>
                                            <option value="2024-2025" {% if module.annee_universitaire == '2024-2025' %}selected{% endif %}>2024-2025</option>
                                            <option value="2025-2026" {% if module.annee_universitaire == '2025-2026' %}selected{% endif %}>2025-2026</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label class="form-label">Volume CM (heures)</label>
                                        <input type="number" class="form-control" name="volume_cm" id="volume_cm" value="{{ module.volume_cm }}" step="0.5">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label class="form-label">Volume TD (heures)</label>
                                        <input type="number" class="form-control" name="volume_td" id="volume_td" value="{{ module.volume_td }}" step="0.5">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label class="form-label">Volume TP (heures)</label>
                                        <input type="number" class="form-control" name="volume_tp" id="volume_tp" value="{{ module.volume_tp }}" step="0.5">
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label class="form-label">Tarif Horaire CM (FCFA)</label>
                                        <input type="number" class="form-control" name="tarif_cm" id="tarif_cm" min="0" step="100" value="{{ module.tarif_cm|default(0) }}">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label class="form-label">Tarif Horaire TD (FCFA)</label>
                                        <input type="number" class="form-control" name="tarif_td" id="tarif_td" min="0" step="100" value="{{ module.tarif_td|default(0) }}">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label class="form-label">Tarif Horaire TP (FCFA)</label>
                                        <input type="number" class="form-control" name="tarif_tp" id="tarif_tp" min="0" step="100" value="{{ module.tarif_tp|default(0) }}">
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label class="form-label">Volume Horaire Total (heures)</label>
                                        <input type="text" class="form-control" id="volume_total_display" readonly value="{{ volume_total|default(module.volume_total) }}">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label class="form-label">Montant Total (FCFA)</label>
                                        <input type="text" class="form-control" id="montant_total_display" readonly value="{{ montant_total|default(module.montant_total) }}">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label class="form-label">Tarif Horaire Moyen (FCFA)</label>
                                        <input type="text" class="form-control" id="montant_heure_display" readonly value="{{ montant_heure|default(module.montant_heure) }}">
                                    </div>
                                </div>
                            </div>

                            <div class="d-grid gap-2">
                                <button type="submit" class="btn btn-primary">Mettre à Jour le Module</button>
                                <a href="/" class="btn btn-secondary">Retour au Tableau de Bord</a>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function calculateTotals() {
            const volume_cm = parseFloat(document.getElementById('volume_cm').value) || 0;
            const volume_td = parseFloat(document.getElementById('volume_td').value) || 0;
            const volume_tp = parseFloat(document.getElementById('volume_tp').value) || 0;
            const tarif_cm = parseFloat(document.getElementById('tarif_cm').value) || 0;
            const tarif_td = parseFloat(document.getElementById('tarif_td').value) || 0;
            const tarif_tp = parseFloat(document.getElementById('tarif_tp').value) || 0;

            const volume_total = volume_cm + volume_td + volume_tp;
            const montant_total = (volume_cm * tarif_cm) + (volume_td * tarif_td) + (volume_tp * tarif_tp);
            const montant_heure = volume_total > 0 ? montant_total / volume_total : 0;

            document.getElementById('volume_total_display').value = volume_total.toFixed(1);
            document.getElementById('montant_total_display').value = montant_total.toFixed(0);
            document.getElementById('montant_heure_display').value = montant_heure.toFixed(0);
        }

        // Add event listeners to all input fields
        document.addEventListener('DOMContentLoaded', function() {
            const inputs = ['volume_cm', 'volume_td', 'volume_tp', 'tarif_cm', 'tarif_td', 'tarif_tp'];
            inputs.forEach(id => {
                document.getElementById(id).addEventListener('input', calculateTotals);
            });
            // Calculate initial totals
            calculateTotals();
        });
    </script>

</body>
</html>
